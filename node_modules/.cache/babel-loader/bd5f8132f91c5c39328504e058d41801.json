{"ast":null,"code":"import sign from \"./sign\";\nimport { buf2hex, str2ab } from \"../strAb\";\nimport { FORMER_S, SEPERATOR } from \"../../config\";\nimport findFormer from \"./findFormer\";\n\nfunction buildTransactionString({\n  sender,\n  receiver,\n  amount,\n  former,\n  refered\n}) {\n  return \"frm:\" + Object.values(former).map(f => f.sig + \":\" + f.amount).reduce(former_string, f => former_string == \"\" ? f : former_string + FORMER_) + SEPERATOR + \"snd:\" + sender + SEPERATOR + \"rcv:\" + receiver + SEPERATOR + \"amt:\" + amount + SEPERATOR + \"ref:\" + refered + SEPERATOR;\n}\n\nfunction addSig(transactionString, sig) {\n  return transactionString + \"sig:\" + buf2hex(sig);\n}\n\nexport default async function (amount, receiver, wallet) {\n  const former = findFormer(wallet, amount);\n\n  if (!former) {\n    console.log(\"Not enough balance apparently!\");\n    return null;\n  }\n\n  let transactionString = buildTransactionString({\n    amount,\n    receiver,\n    sender: wallet.pem_pub_key\n  });\n  const sig = await sign(transactionString, wallet);\n  console.log(\"Create Transaction\", transactionString);\n  transactionString = addSig(transactionString, sig);\n  return transactionString;\n}","map":{"version":3,"sources":["/home/paul/Dokumente/Code/ConsensusLessBlockChain/consensusless-blockchain-wallet/src/services/wallet/createTransaction.js"],"names":["sign","buf2hex","str2ab","FORMER_S","SEPERATOR","findFormer","buildTransactionString","sender","receiver","amount","former","refered","Object","values","map","f","sig","reduce","former_string","FORMER_","addSig","transactionString","wallet","console","log","pem_pub_key"],"mappings":"AAAA,OAAOA,IAAP,MAAiB,QAAjB;AACA,SAASC,OAAT,EAAkBC,MAAlB,QAAgC,UAAhC;AACA,SAASC,QAAT,EAAmBC,SAAnB,QAAoC,cAApC;AACA,OAAOC,UAAP,MAAuB,cAAvB;;AAEA,SAASC,sBAAT,CAAgC;AAAEC,EAAAA,MAAF;AAAUC,EAAAA,QAAV;AAAoBC,EAAAA,MAApB;AAA4BC,EAAAA,MAA5B;AAAoCC,EAAAA;AAApC,CAAhC,EAA+E;AAC7E,SACE,SACAC,MAAM,CAACC,MAAP,CAAcH,MAAd,EAAsBI,GAAtB,CAA0BC,CAAC,IAAIA,CAAC,CAACC,GAAF,GAAQ,GAAR,GAAcD,CAAC,CAACN,MAA/C,EAAuDQ,MAAvD,CAA8DC,aAA9D,EAA6EH,CAAC,IAAIG,aAAa,IAAI,EAAjB,GAAsBH,CAAtB,GAA0BG,aAAa,GAAGC,OAA5H,CADA,GAEAf,SAFA,GAGA,MAHA,GAIAG,MAJA,GAKAH,SALA,GAMA,MANA,GAOAI,QAPA,GAQAJ,SARA,GASA,MATA,GAUAK,MAVA,GAWAL,SAXA,GAYA,MAZA,GAaAO,OAbA,GAcAP,SAfF;AAiBD;;AAED,SAASgB,MAAT,CAAgBC,iBAAhB,EAAmCL,GAAnC,EAAwC;AACtC,SAAOK,iBAAiB,GAAG,MAApB,GAA6BpB,OAAO,CAACe,GAAD,CAA3C;AACD;;AAED,eAAe,gBAAeP,MAAf,EAAuBD,QAAvB,EAAiCc,MAAjC,EAAyC;AACtD,QAAMZ,MAAM,GAAGL,UAAU,CAACiB,MAAD,EAASb,MAAT,CAAzB;;AACA,MAAI,CAACC,MAAL,EAAa;AACXa,IAAAA,OAAO,CAACC,GAAR,CAAY,gCAAZ;AACA,WAAO,IAAP;AACD;;AAED,MAAIH,iBAAiB,GAAGf,sBAAsB,CAAC;AAC7CG,IAAAA,MAD6C;AAE7CD,IAAAA,QAF6C;AAG7CD,IAAAA,MAAM,EAAEe,MAAM,CAACG;AAH8B,GAAD,CAA9C;AAKA,QAAMT,GAAG,GAAG,MAAMhB,IAAI,CAACqB,iBAAD,EAAoBC,MAApB,CAAtB;AACAC,EAAAA,OAAO,CAACC,GAAR,CAAY,oBAAZ,EAAkCH,iBAAlC;AACAA,EAAAA,iBAAiB,GAAGD,MAAM,CAACC,iBAAD,EAAoBL,GAApB,CAA1B;AACA,SAAOK,iBAAP;AACD","sourcesContent":["import sign from \"./sign\";\nimport { buf2hex, str2ab } from \"../strAb\";\nimport { FORMER_S, SEPERATOR } from \"../../config\";\nimport findFormer from \"./findFormer\";\n\nfunction buildTransactionString({ sender, receiver, amount, former, refered }) {\n  return (\n    \"frm:\" +\n    Object.values(former).map(f => f.sig + \":\" + f.amount).reduce(former_string, f => former_string == \"\" ? f : former_string + FORMER_) +\n    SEPERATOR +\n    \"snd:\" +\n    sender +\n    SEPERATOR +\n    \"rcv:\" +\n    receiver +\n    SEPERATOR +\n    \"amt:\" +\n    amount +\n    SEPERATOR +\n    \"ref:\" +\n    refered +\n    SEPERATOR\n  );\n}\n\nfunction addSig(transactionString, sig) {\n  return transactionString + \"sig:\" + buf2hex(sig);\n}\n\nexport default async function(amount, receiver, wallet) {\n  const former = findFormer(wallet, amount);\n  if (!former) {\n    console.log(\"Not enough balance apparently!\");\n    return null;\n  }\n\n  let transactionString = buildTransactionString({\n    amount,\n    receiver,\n    sender: wallet.pem_pub_key\n  });\n  const sig = await sign(transactionString, wallet);\n  console.log(\"Create Transaction\", transactionString);\n  transactionString = addSig(transactionString, sig);\n  return transactionString;\n}\n"]},"metadata":{},"sourceType":"module"}