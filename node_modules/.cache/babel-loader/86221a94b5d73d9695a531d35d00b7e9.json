{"ast":null,"code":"\"use strict\";\n/**\n * webapi.js\n */\n\nvar __awaiter = this && this.__awaiter || function (thisArg, _arguments, P, generator) {\n  function adopt(value) {\n    return value instanceof P ? value : new P(function (resolve) {\n      resolve(value);\n    });\n  }\n\n  return new (P || (P = Promise))(function (resolve, reject) {\n    function fulfilled(value) {\n      try {\n        step(generator.next(value));\n      } catch (e) {\n        reject(e);\n      }\n    }\n\n    function rejected(value) {\n      try {\n        step(generator[\"throw\"](value));\n      } catch (e) {\n        reject(e);\n      }\n    }\n\n    function step(result) {\n      result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected);\n    }\n\n    step((generator = generator.apply(thisArg, _arguments || [])).next());\n  });\n};\n\nvar __generator = this && this.__generator || function (thisArg, body) {\n  var _ = {\n    label: 0,\n    sent: function () {\n      if (t[0] & 1) throw t[1];\n      return t[1];\n    },\n    trys: [],\n    ops: []\n  },\n      f,\n      y,\n      t,\n      g;\n  return g = {\n    next: verb(0),\n    \"throw\": verb(1),\n    \"return\": verb(2)\n  }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function () {\n    return this;\n  }), g;\n\n  function verb(n) {\n    return function (v) {\n      return step([n, v]);\n    };\n  }\n\n  function step(op) {\n    if (f) throw new TypeError(\"Generator is already executing.\");\n\n    while (_) try {\n      if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\n      if (y = 0, t) op = [op[0] & 2, t.value];\n\n      switch (op[0]) {\n        case 0:\n        case 1:\n          t = op;\n          break;\n\n        case 4:\n          _.label++;\n          return {\n            value: op[1],\n            done: false\n          };\n\n        case 5:\n          _.label++;\n          y = op[1];\n          op = [0];\n          continue;\n\n        case 7:\n          op = _.ops.pop();\n\n          _.trys.pop();\n\n          continue;\n\n        default:\n          if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) {\n            _ = 0;\n            continue;\n          }\n\n          if (op[0] === 3 && (!t || op[1] > t[0] && op[1] < t[3])) {\n            _.label = op[1];\n            break;\n          }\n\n          if (op[0] === 6 && _.label < t[1]) {\n            _.label = t[1];\n            t = op;\n            break;\n          }\n\n          if (t && _.label < t[2]) {\n            _.label = t[2];\n\n            _.ops.push(op);\n\n            break;\n          }\n\n          if (t[2]) _.ops.pop();\n\n          _.trys.pop();\n\n          continue;\n      }\n\n      op = body.call(thisArg, _);\n    } catch (e) {\n      op = [6, e];\n      y = 0;\n    } finally {\n      f = t = 0;\n    }\n\n    if (op[0] & 5) throw op[1];\n    return {\n      value: op[0] ? op[1] : void 0,\n      done: true\n    };\n  }\n};\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n/**\n * WebCrypto KeyWrapping function simply uses encrypt function.\n * @param keyToBeWrapped {Uint8Array} - plaintext key\n * @param wrappingKey {Uint8Array} - wrapping key\n * @param name {string} - 'AES-KW'\n * @param iv {Uint8Array} - default is '0xA6A6A6A6A6A6A6A6'\n * @param webCrypto {Object} - crypto.subtle object\n * @return {Uint8Array} - Unwrapped Key\n */\n\nexports.wrapKey = function (keyToBeWrapped, wrappingKey, _a, webCrypto) {\n  var name = _a.name,\n      iv = _a.iv;\n  return __awaiter(void 0, void 0, void 0, function () {\n    var kek, cek, data, e_1;\n    return __generator(this, function (_b) {\n      switch (_b.label) {\n        case 0:\n          if (!(typeof window.msCrypto === 'undefined')) return [3\n          /*break*/\n          , 7];\n          _b.label = 1;\n\n        case 1:\n          _b.trys.push([1, 5,, 6]);\n\n          return [4\n          /*yield*/\n          , webCrypto.importKey('raw', wrappingKey, {\n            name: name\n          }, false, ['wrapKey', 'unwrapKey'])];\n\n        case 2:\n          kek = _b.sent();\n          return [4\n          /*yield*/\n          , webCrypto.importKey('raw', keyToBeWrapped, {\n            name: name\n          }, true, ['wrapKey', 'unwrapKey'])];\n\n        case 3:\n          cek = _b.sent();\n          return [4\n          /*yield*/\n          , webCrypto.wrapKey('raw', cek, kek, {\n            name: name,\n            iv: iv\n          })];\n\n        case 4:\n          data = _b.sent();\n          return [2\n          /*return*/\n          , new Uint8Array(data)];\n\n        case 5:\n          e_1 = _b.sent();\n          throw new Error(\"WebCrypto_FailedToWrapKey - \" + e_1.message);\n\n        case 6:\n          return [3\n          /*break*/\n          , 8];\n\n        case 7:\n          throw new Error('ThrowAwayIeAsap');\n\n        case 8:\n          return [2\n          /*return*/\n          ];\n      }\n    });\n  });\n};\n/**\n * WebCrypto KeyUnwrapping function as well as keyWrapping\n * @param wrappedKey {Uint8Array} - Wrapped key\n * @param unwrappingKey {Uint8Array} - Key used for wrapping\n * @param name {string} - 'AES-KW'\n * @param iv {Uint8Array} - default is '0xA6A6A6A6A6A6A6A6'\n * @param webCrypto {Object} - crypto.subtle object\n * @return {Uint8Array} - Unwrapped Key\n */\n\n\nexports.unwrapKey = function (wrappedKey, unwrappingKey, _a, webCrypto) {\n  var name = _a.name,\n      iv = _a.iv;\n  return __awaiter(void 0, void 0, void 0, function () {\n    var kek, cek, _b, e_2;\n\n    return __generator(this, function (_c) {\n      switch (_c.label) {\n        case 0:\n          if (!(typeof window.msCrypto === 'undefined')) return [3\n          /*break*/\n          , 7];\n          _c.label = 1;\n\n        case 1:\n          _c.trys.push([1, 5,, 6]);\n\n          return [4\n          /*yield*/\n          , webCrypto.importKey('raw', unwrappingKey, {\n            name: name\n          }, false, ['wrapKey', 'unwrapKey'])];\n\n        case 2:\n          kek = _c.sent();\n          return [4\n          /*yield*/\n          , webCrypto.unwrapKey('raw', wrappedKey, kek, {\n            name: name,\n            iv: iv\n          }, {\n            name: 'AES-GCM'\n          }, true, ['encrypt', 'decrypt'])];\n\n        case 3:\n          cek = _c.sent();\n          _b = Uint8Array.bind;\n          return [4\n          /*yield*/\n          , webCrypto.exportKey('raw', cek)];\n\n        case 4:\n          return [2\n          /*return*/\n          , new (_b.apply(Uint8Array, [void 0, _c.sent()]))()];\n\n        case 5:\n          e_2 = _c.sent();\n          throw new Error(\"WebCrypto_FailedToUnwrapKey - \" + e_2.message);\n\n        case 6:\n          return [3\n          /*break*/\n          , 8];\n\n        case 7:\n          throw new Error('ThrowAwayMsIeAsap');\n\n        case 8:\n          return [2\n          /*return*/\n          ];\n      }\n    });\n  });\n};\n/**\n * Encrypt data through AES of WebCrypto API.\n * @param {Uint8Array} msg - Plaintext message to be encrypted.\n * @param {Uint8Array} key - Byte array of symmetric key.\n * @param {String} name - Name of AES algorithm like 'AES-GCM'.\n * @param {Uint8Array} [iv] - Byte array of initial vector if required.\n * @param {Uint8Array} [additionalData] - Byte array of additional data if required.\n * @param {Number} [tagLength] - Authentication tag length if required.\n * @param {Object} webCrypto - WebCrypto object, i.e., window.crypto.subtle or window.msCrypto.subtle\n * @return {Promise<Uint8Array>} - Encrypted data byte array.\n * @throws {Error} - Throws if UnsupportedCipher.\n */\n\n\nexports.encrypt = function (msg, key, _a, webCrypto) {\n  var _b = _a.name,\n      name = _b === void 0 ? 'AES-GCM' : _b,\n      iv = _a.iv,\n      additionalData = _a.additionalData,\n      tagLength = _a.tagLength;\n  return __awaiter(void 0, void 0, void 0, function () {\n    var encryptionConfig, sessionKeyObj, data, e_3, sessionKeyObj, encryptedObj, data, e_4;\n    return __generator(this, function (_c) {\n      switch (_c.label) {\n        case 0:\n          encryptionConfig = setCipherParams({\n            name: name,\n            iv: iv,\n            additionalData: additionalData,\n            tagLength: tagLength\n          });\n          if (!(typeof window.msCrypto === 'undefined')) return [3\n          /*break*/\n          , 6];\n          _c.label = 1;\n\n        case 1:\n          _c.trys.push([1, 4,, 5]);\n\n          return [4\n          /*yield*/\n          , webCrypto.importKey('raw', key, encryptionConfig, false, ['encrypt', 'decrypt'])];\n\n        case 2:\n          sessionKeyObj = _c.sent();\n          return [4\n          /*yield*/\n          , webCrypto.encrypt(encryptionConfig, sessionKeyObj, msg)];\n\n        case 3:\n          data = _c.sent();\n          return [2\n          /*return*/\n          , new Uint8Array(data)];\n\n        case 4:\n          e_3 = _c.sent();\n          throw new Error(\"WebCrypto_EncryptionFailure: \" + e_3.message);\n\n        case 5:\n          return [3\n          /*break*/\n          , 10];\n\n        case 6:\n          _c.trys.push([6, 9,, 10]);\n\n          return [4\n          /*yield*/\n          , msImportKey('raw', key, encryptionConfig, false, ['encrypt', 'decrypt'], webCrypto)];\n\n        case 7:\n          sessionKeyObj = _c.sent();\n          return [4\n          /*yield*/\n          , msEncrypt(encryptionConfig, sessionKeyObj, msg, webCrypto)];\n\n        case 8:\n          encryptedObj = _c.sent();\n\n          if (name === 'AES-GCM') {\n            data = new Uint8Array(encryptedObj.ciphertext.byteLength + encryptedObj.tag.byteLength);\n            data.set(new Uint8Array(encryptedObj.ciphertext));\n            data.set(new Uint8Array(encryptedObj.tag), encryptedObj.ciphertext.byteLength);\n            return [2\n            /*return*/\n            , data];\n          } else return [2\n          /*return*/\n          , new Uint8Array(encryptedObj)];\n\n          return [3\n          /*break*/\n          , 10];\n\n        case 9:\n          e_4 = _c.sent();\n          throw new Error(\"ThrowAwayMsIeAsap: \" + e_4.message);\n\n        case 10:\n          return [2\n          /*return*/\n          ];\n      }\n    });\n  });\n};\n/**\n * Decrypt data through AES of WebCrypto API.\n * @param {Uint8Array} data - Encrypted message to be decrypted.\n * @param {Uint8Array} key - Byte array of symmetric key.\n * @param {String} name - Name of AES algorithm like 'AES-GCM'.\n * @param {Uint8Array} [iv] - Byte array of initial vector if required.\n * @param {Uint8Array} [additionalData] - Byte array of additional data if required.\n * @param {Number} [tagLength] - Authentication tag length if required.\n * @param {Object} webCrypto - WebCrypto object, i.e., window.crypto.subtle or window.msCrypto.subtle\n * @return {Promise<Uint8Array>} - Decrypted plaintext message.\n * @throws {Error} - Throws if UnsupportedCipher or DecryptionFailure.\n */\n\n\nexports.decrypt = function (data, key, _a, webCrypto) {\n  var name = _a.name,\n      iv = _a.iv,\n      additionalData = _a.additionalData,\n      tagLength = _a.tagLength;\n  return __awaiter(void 0, void 0, void 0, function () {\n    var decryptionConfig, sessionKeyObj, msg, e_5, sessionKeyObj, msg, ciphertext, tag, e_6;\n    return __generator(this, function (_b) {\n      switch (_b.label) {\n        case 0:\n          decryptionConfig = setCipherParams({\n            name: name,\n            iv: iv,\n            additionalData: additionalData,\n            tagLength: tagLength\n          });\n          if (!!window.msCrypto) return [3\n          /*break*/\n          , 6];\n          _b.label = 1;\n\n        case 1:\n          _b.trys.push([1, 4,, 5]);\n\n          return [4\n          /*yield*/\n          , webCrypto.importKey('raw', key, decryptionConfig, false, ['encrypt', 'decrypt'])];\n\n        case 2:\n          sessionKeyObj = _b.sent();\n          return [4\n          /*yield*/\n          , webCrypto.decrypt(decryptionConfig, sessionKeyObj, data)];\n\n        case 3:\n          msg = _b.sent();\n          return [2\n          /*return*/\n          , new Uint8Array(msg)];\n\n        case 4:\n          e_5 = _b.sent();\n          throw new Error(\"WebCrypto_DecryptionFailure: \" + e_5.message);\n\n        case 5:\n          return [3\n          /*break*/\n          , 13];\n\n        case 6:\n          _b.trys.push([6, 12,, 13]);\n\n          return [4\n          /*yield*/\n          , msImportKey('raw', key, decryptionConfig, false, ['encrypt', 'decrypt'], webCrypto)];\n\n        case 7:\n          sessionKeyObj = _b.sent();\n          msg = void 0;\n          if (!(name === 'AES-GCM')) return [3\n          /*break*/\n          , 9];\n          ciphertext = data.slice(0, data.length - tagLength);\n          tag = data.slice(data.length - tagLength, data.length);\n          return [4\n          /*yield*/\n          , msDecrypt(Object.assign(decryptionConfig, {\n            tag: tag\n          }), sessionKeyObj, ciphertext, webCrypto)];\n\n        case 8:\n          msg = _b.sent();\n          return [3\n          /*break*/\n          , 11];\n\n        case 9:\n          return [4\n          /*yield*/\n          , msDecrypt(decryptionConfig, sessionKeyObj, data, webCrypto)];\n\n        case 10:\n          msg = _b.sent();\n          _b.label = 11;\n\n        case 11:\n          return [2\n          /*return*/\n          , new Uint8Array(msg)];\n\n        case 12:\n          e_6 = _b.sent();\n          throw new Error(\"ThrowAwayMsIeAsap: \" + e_6.message);\n\n        case 13:\n          return [2\n          /*return*/\n          ];\n      }\n    });\n  });\n};\n/**\n * Set params for encryption algorithms.\n * @param {String} name - Name of AES algorithm like 'AES-GCM'.\n * @param {Uint8Array} [iv] - Byte array of initial vector if required.\n * @param {Uint8Array} [additionalData] - Byte array of additional data if required.\n * @param {Number} [tagLength] - Authentication tag length if required.\n */\n\n\nvar setCipherParams = function (_a) {\n  var name = _a.name,\n      iv = _a.iv,\n      additionalData = _a.additionalData,\n      tagLength = _a.tagLength;\n  var alg = {\n    name: name,\n    iv: iv,\n    additionalData: additionalData,\n    tagLength: tagLength\n  };\n\n  switch (name) {\n    case 'AES-GCM':\n      {\n        alg.tagLength = tagLength * 8;\n        break;\n      }\n\n    case 'AES-CBC':\n      {\n        break;\n      }\n\n    case 'AES-CTR':\n      {\n        if (iv.length === 0 || iv.length > 16) throw new Error('InvalidIVLength');\n        alg.counter = new Uint8Array(16);\n        alg.counter.set(iv);\n        alg.counter[15] += 1;\n        alg.length = 128; // todo: this might be  (16 - iv.length) * 8.\n\n        break;\n      }\n  }\n\n  return alg;\n}; // function definitions for IE\n// should die asap\n\n\nvar msImportKey = function (type, key, alg, ext, use, webCrypto) {\n  return new Promise(function (resolve, reject) {\n    var op = webCrypto.importKey(type, key, alg, ext, use);\n\n    op.oncomplete = function (evt) {\n      resolve(evt.target.result);\n    };\n\n    op.onerror = function () {\n      reject('KeyImportingFailed');\n    };\n  });\n};\n\nvar msEncrypt = function (alg, key, msg, webCrypto) {\n  return new Promise(function (resolve, reject) {\n    var op = webCrypto.encrypt(alg, key, msg);\n\n    op.oncomplete = function (evt) {\n      resolve(evt.target.result);\n    };\n\n    op.onerror = function () {\n      reject('EncryptionFailure');\n    };\n  });\n};\n\nvar msDecrypt = function (alg, key, data, webCrypto) {\n  return new Promise(function (resolve, reject) {\n    var op = webCrypto.decrypt(alg, key, data);\n\n    op.oncomplete = function (evt) {\n      resolve(evt.target.result);\n    };\n\n    op.onerror = function () {\n      reject('DecryptionFailure');\n    };\n  });\n};","map":{"version":3,"sources":["/home/paul/Dokumente/Code/ConsensusLessBlockChain/consensusless-blockchain-wallet/node_modules/js-crypto-aes/dist/webapi.js"],"names":["__awaiter","thisArg","_arguments","P","generator","adopt","value","resolve","Promise","reject","fulfilled","step","next","e","rejected","result","done","then","apply","__generator","body","_","label","sent","t","trys","ops","f","y","g","verb","Symbol","iterator","n","v","op","TypeError","call","pop","length","push","Object","defineProperty","exports","wrapKey","keyToBeWrapped","wrappingKey","_a","webCrypto","name","iv","kek","cek","data","e_1","_b","window","msCrypto","importKey","Uint8Array","Error","message","unwrapKey","wrappedKey","unwrappingKey","e_2","_c","bind","exportKey","encrypt","msg","key","additionalData","tagLength","encryptionConfig","sessionKeyObj","e_3","encryptedObj","e_4","setCipherParams","msImportKey","msEncrypt","ciphertext","byteLength","tag","set","decrypt","decryptionConfig","e_5","e_6","slice","msDecrypt","assign","alg","counter","type","ext","use","oncomplete","evt","target","onerror"],"mappings":"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","sourcesContent":["\"use strict\";\n/**\n * webapi.js\n */\nvar __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\n    return new (P || (P = Promise))(function (resolve, reject) {\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\n    });\n};\nvar __generator = (this && this.__generator) || function (thisArg, body) {\n    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;\n    return g = { next: verb(0), \"throw\": verb(1), \"return\": verb(2) }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function() { return this; }), g;\n    function verb(n) { return function (v) { return step([n, v]); }; }\n    function step(op) {\n        if (f) throw new TypeError(\"Generator is already executing.\");\n        while (_) try {\n            if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\n            if (y = 0, t) op = [op[0] & 2, t.value];\n            switch (op[0]) {\n                case 0: case 1: t = op; break;\n                case 4: _.label++; return { value: op[1], done: false };\n                case 5: _.label++; y = op[1]; op = [0]; continue;\n                case 7: op = _.ops.pop(); _.trys.pop(); continue;\n                default:\n                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }\n                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }\n                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }\n                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }\n                    if (t[2]) _.ops.pop();\n                    _.trys.pop(); continue;\n            }\n            op = body.call(thisArg, _);\n        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }\n        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };\n    }\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\n/**\n * WebCrypto KeyWrapping function simply uses encrypt function.\n * @param keyToBeWrapped {Uint8Array} - plaintext key\n * @param wrappingKey {Uint8Array} - wrapping key\n * @param name {string} - 'AES-KW'\n * @param iv {Uint8Array} - default is '0xA6A6A6A6A6A6A6A6'\n * @param webCrypto {Object} - crypto.subtle object\n * @return {Uint8Array} - Unwrapped Key\n */\nexports.wrapKey = function (keyToBeWrapped, wrappingKey, _a, webCrypto) {\n    var name = _a.name, iv = _a.iv;\n    return __awaiter(void 0, void 0, void 0, function () {\n        var kek, cek, data, e_1;\n        return __generator(this, function (_b) {\n            switch (_b.label) {\n                case 0:\n                    if (!(typeof window.msCrypto === 'undefined')) return [3 /*break*/, 7];\n                    _b.label = 1;\n                case 1:\n                    _b.trys.push([1, 5, , 6]);\n                    return [4 /*yield*/, webCrypto.importKey('raw', wrappingKey, { name: name }, false, ['wrapKey', 'unwrapKey'])];\n                case 2:\n                    kek = _b.sent();\n                    return [4 /*yield*/, webCrypto.importKey('raw', keyToBeWrapped, { name: name }, true, ['wrapKey', 'unwrapKey'])];\n                case 3:\n                    cek = _b.sent();\n                    return [4 /*yield*/, webCrypto.wrapKey('raw', cek, kek, { name: name, iv: iv })];\n                case 4:\n                    data = _b.sent();\n                    return [2 /*return*/, new Uint8Array(data)];\n                case 5:\n                    e_1 = _b.sent();\n                    throw new Error(\"WebCrypto_FailedToWrapKey - \" + e_1.message);\n                case 6: return [3 /*break*/, 8];\n                case 7: throw new Error('ThrowAwayIeAsap');\n                case 8: return [2 /*return*/];\n            }\n        });\n    });\n};\n/**\n * WebCrypto KeyUnwrapping function as well as keyWrapping\n * @param wrappedKey {Uint8Array} - Wrapped key\n * @param unwrappingKey {Uint8Array} - Key used for wrapping\n * @param name {string} - 'AES-KW'\n * @param iv {Uint8Array} - default is '0xA6A6A6A6A6A6A6A6'\n * @param webCrypto {Object} - crypto.subtle object\n * @return {Uint8Array} - Unwrapped Key\n */\nexports.unwrapKey = function (wrappedKey, unwrappingKey, _a, webCrypto) {\n    var name = _a.name, iv = _a.iv;\n    return __awaiter(void 0, void 0, void 0, function () {\n        var kek, cek, _b, e_2;\n        return __generator(this, function (_c) {\n            switch (_c.label) {\n                case 0:\n                    if (!(typeof window.msCrypto === 'undefined')) return [3 /*break*/, 7];\n                    _c.label = 1;\n                case 1:\n                    _c.trys.push([1, 5, , 6]);\n                    return [4 /*yield*/, webCrypto.importKey('raw', unwrappingKey, { name: name }, false, ['wrapKey', 'unwrapKey'])];\n                case 2:\n                    kek = _c.sent();\n                    return [4 /*yield*/, webCrypto.unwrapKey('raw', wrappedKey, kek, { name: name, iv: iv }, { name: 'AES-GCM' }, true, ['encrypt', 'decrypt'])];\n                case 3:\n                    cek = _c.sent();\n                    _b = Uint8Array.bind;\n                    return [4 /*yield*/, webCrypto.exportKey('raw', cek)];\n                case 4: return [2 /*return*/, new (_b.apply(Uint8Array, [void 0, _c.sent()]))()];\n                case 5:\n                    e_2 = _c.sent();\n                    throw new Error(\"WebCrypto_FailedToUnwrapKey - \" + e_2.message);\n                case 6: return [3 /*break*/, 8];\n                case 7: throw new Error('ThrowAwayMsIeAsap');\n                case 8: return [2 /*return*/];\n            }\n        });\n    });\n};\n/**\n * Encrypt data through AES of WebCrypto API.\n * @param {Uint8Array} msg - Plaintext message to be encrypted.\n * @param {Uint8Array} key - Byte array of symmetric key.\n * @param {String} name - Name of AES algorithm like 'AES-GCM'.\n * @param {Uint8Array} [iv] - Byte array of initial vector if required.\n * @param {Uint8Array} [additionalData] - Byte array of additional data if required.\n * @param {Number} [tagLength] - Authentication tag length if required.\n * @param {Object} webCrypto - WebCrypto object, i.e., window.crypto.subtle or window.msCrypto.subtle\n * @return {Promise<Uint8Array>} - Encrypted data byte array.\n * @throws {Error} - Throws if UnsupportedCipher.\n */\nexports.encrypt = function (msg, key, _a, webCrypto) {\n    var _b = _a.name, name = _b === void 0 ? 'AES-GCM' : _b, iv = _a.iv, additionalData = _a.additionalData, tagLength = _a.tagLength;\n    return __awaiter(void 0, void 0, void 0, function () {\n        var encryptionConfig, sessionKeyObj, data, e_3, sessionKeyObj, encryptedObj, data, e_4;\n        return __generator(this, function (_c) {\n            switch (_c.label) {\n                case 0:\n                    encryptionConfig = setCipherParams({ name: name, iv: iv, additionalData: additionalData, tagLength: tagLength });\n                    if (!(typeof window.msCrypto === 'undefined')) return [3 /*break*/, 6];\n                    _c.label = 1;\n                case 1:\n                    _c.trys.push([1, 4, , 5]);\n                    return [4 /*yield*/, webCrypto.importKey('raw', key, encryptionConfig, false, ['encrypt', 'decrypt'])];\n                case 2:\n                    sessionKeyObj = _c.sent();\n                    return [4 /*yield*/, webCrypto.encrypt(encryptionConfig, sessionKeyObj, msg)];\n                case 3:\n                    data = _c.sent();\n                    return [2 /*return*/, new Uint8Array(data)];\n                case 4:\n                    e_3 = _c.sent();\n                    throw new Error(\"WebCrypto_EncryptionFailure: \" + e_3.message);\n                case 5: return [3 /*break*/, 10];\n                case 6:\n                    _c.trys.push([6, 9, , 10]);\n                    return [4 /*yield*/, msImportKey('raw', key, encryptionConfig, false, ['encrypt', 'decrypt'], webCrypto)];\n                case 7:\n                    sessionKeyObj = _c.sent();\n                    return [4 /*yield*/, msEncrypt(encryptionConfig, sessionKeyObj, msg, webCrypto)];\n                case 8:\n                    encryptedObj = _c.sent();\n                    if (name === 'AES-GCM') {\n                        data = new Uint8Array(encryptedObj.ciphertext.byteLength + encryptedObj.tag.byteLength);\n                        data.set(new Uint8Array(encryptedObj.ciphertext));\n                        data.set(new Uint8Array(encryptedObj.tag), encryptedObj.ciphertext.byteLength);\n                        return [2 /*return*/, data];\n                    }\n                    else\n                        return [2 /*return*/, new Uint8Array(encryptedObj)];\n                    return [3 /*break*/, 10];\n                case 9:\n                    e_4 = _c.sent();\n                    throw new Error(\"ThrowAwayMsIeAsap: \" + e_4.message);\n                case 10: return [2 /*return*/];\n            }\n        });\n    });\n};\n/**\n * Decrypt data through AES of WebCrypto API.\n * @param {Uint8Array} data - Encrypted message to be decrypted.\n * @param {Uint8Array} key - Byte array of symmetric key.\n * @param {String} name - Name of AES algorithm like 'AES-GCM'.\n * @param {Uint8Array} [iv] - Byte array of initial vector if required.\n * @param {Uint8Array} [additionalData] - Byte array of additional data if required.\n * @param {Number} [tagLength] - Authentication tag length if required.\n * @param {Object} webCrypto - WebCrypto object, i.e., window.crypto.subtle or window.msCrypto.subtle\n * @return {Promise<Uint8Array>} - Decrypted plaintext message.\n * @throws {Error} - Throws if UnsupportedCipher or DecryptionFailure.\n */\nexports.decrypt = function (data, key, _a, webCrypto) {\n    var name = _a.name, iv = _a.iv, additionalData = _a.additionalData, tagLength = _a.tagLength;\n    return __awaiter(void 0, void 0, void 0, function () {\n        var decryptionConfig, sessionKeyObj, msg, e_5, sessionKeyObj, msg, ciphertext, tag, e_6;\n        return __generator(this, function (_b) {\n            switch (_b.label) {\n                case 0:\n                    decryptionConfig = setCipherParams({ name: name, iv: iv, additionalData: additionalData, tagLength: tagLength });\n                    if (!!window.msCrypto) return [3 /*break*/, 6];\n                    _b.label = 1;\n                case 1:\n                    _b.trys.push([1, 4, , 5]);\n                    return [4 /*yield*/, webCrypto.importKey('raw', key, decryptionConfig, false, ['encrypt', 'decrypt'])];\n                case 2:\n                    sessionKeyObj = _b.sent();\n                    return [4 /*yield*/, webCrypto.decrypt(decryptionConfig, sessionKeyObj, data)];\n                case 3:\n                    msg = _b.sent();\n                    return [2 /*return*/, new Uint8Array(msg)];\n                case 4:\n                    e_5 = _b.sent();\n                    throw new Error(\"WebCrypto_DecryptionFailure: \" + e_5.message);\n                case 5: return [3 /*break*/, 13];\n                case 6:\n                    _b.trys.push([6, 12, , 13]);\n                    return [4 /*yield*/, msImportKey('raw', key, decryptionConfig, false, ['encrypt', 'decrypt'], webCrypto)];\n                case 7:\n                    sessionKeyObj = _b.sent();\n                    msg = void 0;\n                    if (!(name === 'AES-GCM')) return [3 /*break*/, 9];\n                    ciphertext = data.slice(0, data.length - tagLength);\n                    tag = data.slice(data.length - tagLength, data.length);\n                    return [4 /*yield*/, msDecrypt(Object.assign(decryptionConfig, { tag: tag }), sessionKeyObj, ciphertext, webCrypto)];\n                case 8:\n                    msg = _b.sent();\n                    return [3 /*break*/, 11];\n                case 9: return [4 /*yield*/, msDecrypt(decryptionConfig, sessionKeyObj, data, webCrypto)];\n                case 10:\n                    msg = _b.sent();\n                    _b.label = 11;\n                case 11: return [2 /*return*/, new Uint8Array(msg)];\n                case 12:\n                    e_6 = _b.sent();\n                    throw new Error(\"ThrowAwayMsIeAsap: \" + e_6.message);\n                case 13: return [2 /*return*/];\n            }\n        });\n    });\n};\n/**\n * Set params for encryption algorithms.\n * @param {String} name - Name of AES algorithm like 'AES-GCM'.\n * @param {Uint8Array} [iv] - Byte array of initial vector if required.\n * @param {Uint8Array} [additionalData] - Byte array of additional data if required.\n * @param {Number} [tagLength] - Authentication tag length if required.\n */\nvar setCipherParams = function (_a) {\n    var name = _a.name, iv = _a.iv, additionalData = _a.additionalData, tagLength = _a.tagLength;\n    var alg = { name: name, iv: iv, additionalData: additionalData, tagLength: tagLength };\n    switch (name) {\n        case 'AES-GCM': {\n            alg.tagLength = tagLength * 8;\n            break;\n        }\n        case 'AES-CBC': {\n            break;\n        }\n        case 'AES-CTR': {\n            if (iv.length === 0 || iv.length > 16)\n                throw new Error('InvalidIVLength');\n            alg.counter = new Uint8Array(16);\n            alg.counter.set(iv);\n            alg.counter[15] += 1;\n            alg.length = 128; // todo: this might be  (16 - iv.length) * 8.\n            break;\n        }\n    }\n    return alg;\n};\n// function definitions for IE\n// should die asap\nvar msImportKey = function (type, key, alg, ext, use, webCrypto) { return new Promise(function (resolve, reject) {\n    var op = webCrypto.importKey(type, key, alg, ext, use);\n    op.oncomplete = function (evt) { resolve(evt.target.result); };\n    op.onerror = function () { reject('KeyImportingFailed'); };\n}); };\nvar msEncrypt = function (alg, key, msg, webCrypto) { return new Promise(function (resolve, reject) {\n    var op = webCrypto.encrypt(alg, key, msg);\n    op.oncomplete = function (evt) { resolve(evt.target.result); };\n    op.onerror = function () { reject('EncryptionFailure'); };\n}); };\nvar msDecrypt = function (alg, key, data, webCrypto) { return new Promise(function (resolve, reject) {\n    var op = webCrypto.decrypt(alg, key, data);\n    op.oncomplete = function (evt) { resolve(evt.target.result); };\n    op.onerror = function () { reject('DecryptionFailure'); };\n}); };\n//# sourceMappingURL=webapi.js.map"]},"metadata":{},"sourceType":"script"}